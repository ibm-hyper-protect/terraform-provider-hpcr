---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "hpcr Provider"
description: |-
  Terraform provider for IBM Cloud Hyper Protect Virtual Server for VPC (HPCR). This provider helps create encrypted contracts and user data for secure virtual servers using the contract-go library.
---

# hpcr Provider

Terraform provider for [IBM Cloud Hyper Protect Virtual Server for VPC (HPCR)](https://cloud.ibm.com/docs/vpc?topic=vpc-about-se). This provider helps create encrypted contracts and user data for secure virtual servers running on IBM's confidential computing infrastructure.

## Overview

This provider leverages the [contract-go library](https://ibm-hyper-protect.github.io/contract-go) to encrypt, sign, and validate contracts for deploying containerized workloads on IBM Hyper Protect services. It supports:

- **Multiple Platforms**: HPVS (Hyper Protect Virtual Servers), HPCR RHVS (Container Runtime for Red Hat Virtualization), and HPCC Peer Pods (Confidential Container Peer Pods)
- **Secure Encryption**: Uses OpenSSL to encrypt contract sections with platform-specific certificates
- **Digital Signatures**: RSA signing for contract integrity verification and non-repudiation
- **Automated Key Management**: Automatically generates temporary signing keys when not provided
- **Base64 Encoding**: All outputs are base64-encoded and include SHA256 checksums for verification

## Prerequisites

- **Terraform**: Version 0.13.x or higher
- **OpenSSL**: Binary (not LibreSSL) - the path can be configured via the `OPENSSL_BIN` environment variable
- **Go**: 1.23.0 or higher (for local development)

## Use Cases

### Contract Generation

The primary use case is generating encrypted contracts for HPCR virtual servers. A contract consists of:

1. **Workload Section**: Docker Compose or Podman configuration (typically as a base64-encoded TGZ archive)
2. **Environment Section**: Configuration metadata including logging endpoints, API credentials, and platform specifications

Both sections are encrypted separately using the platform's encryption certificate and then signed to produce the final `user_data` field for your virtual server.

### Example Workflow

```terraform
# 1. Create a TGZ archive from your docker-compose folder
resource "hpcr_tgz" "compose" {
  folder = "./my-compose-folder"
}

# 2. Encrypt the workload section
resource "hpcr_text_encrypted" "workload" {
  text = yamlencode({
    "compose" : {
      "archive" : resource.hpcr_tgz.compose.rendered
    }
  })
}

# 3. Encrypt the environment section
resource "hpcr_text_encrypted" "env" {
  text = yamlencode({
    "type" : "env",
    "logging" : {
      "syslog" : {
        "hostname" : "example.com",
        "port" : 514
      }
    }
  })
}

# 4. Get the encryption certificate
data "hpcr_encryption_cert" "cert" {
  region = "us-south"
}

# 5. Generate the final encrypted contract
resource "hpcr_contract_encrypted" "contract" {
  contract = yamlencode({
    "workload" : resource.hpcr_text_encrypted.workload.rendered,
    "env" : resource.hpcr_text_encrypted.env.rendered
  })
  cert = data.hpcr_encryption_cert.cert.cert
}

# 6. Use the rendered contract as user_data for your virtual server
output "user_data" {
  value = resource.hpcr_contract_encrypted.contract.rendered
  sensitive = true
}
```

## Security Features

- **Certificate-Based Encryption**: Uses platform-specific public key certificates to ensure only the target platform can decrypt the contract
- **Signature Verification**: All contracts are digitally signed to ensure integrity and authenticity
- **Sensitive Data Handling**: Contract and private key fields are marked as sensitive in Terraform
- **Checksum Validation**: SHA256 checksums are computed for both input and output to detect tampering

## Resources and Data Sources

### Resources

- `hpcr_tgz` - Create TGZ archives from folders
- `hpcr_tgz_encrypted` - Create encrypted TGZ archives
- `hpcr_text` - Encode text to base64
- `hpcr_text_encrypted` - Encrypt and encode text
- `hpcr_json` - Encode JSON to base64
- `hpcr_json_encrypted` - Encrypt and encode JSON
- `hpcr_contract_encrypted` - Generate encrypted and signed contracts
- `hpcr_contract_encrypted_contract_expiry` - Generate contracts with expiration dates

### Data Sources

- `hpcr_image` - Select HPCR stock images using semantic versioning
- `hpcr_attestation` - Retrieve attestation data
- `hpcr_encryption_cert` - Get a single encryption certificate
- `hpcr_encryption_certs` - Get multiple encryption certificates

<!-- schema generated by tfplugindocs -->
## Schema
