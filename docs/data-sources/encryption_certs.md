---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "hpcr_encryption_certs Data Source - hpcr"
subcategory: ""
description: |-
  Downloads encryption certificates from IBM Cloud Object Storage for specified HPCR image versions.
---

# hpcr_encryption_certs (Data Source)

Downloads encryption certificates from the official IBM Cloud Object Storage location for specified HPCR image versions. This data source uses the contract-go library's `HpcrDownloadEncryptionCertificates()` function to retrieve PEM-formatted public key certificates used for encrypting contracts.

## How It Works

This data source:

1. **Accepts Version List**: Takes a list of HPCR image version numbers (e.g., `["1.0.10", "1.0.11"]`)
2. **Downloads Certificates**: Fetches the corresponding encryption certificates from IBM Cloud Object Storage
3. **Returns Map**: Provides a map where keys are version numbers and values are PEM-formatted certificates
4. **Custom Templates**: Optionally supports custom URL templates for certificate retrieval

The downloaded certificates are platform-specific public keys used to encrypt contract sections, ensuring only the target HPCR platform can decrypt and execute the workload.

## Example Usage

```terraform
# Download certificates for specific versions
data "hpcr_encryption_certs" "available" {
  versions = ["1.0.10", "1.0.11", "1.0.12"]
}

# Use with hpcr_encryption_cert to select one
data "hpcr_encryption_cert" "latest" {
  certs = data.hpcr_encryption_certs.available.certs
  spec  = "*"  # Select latest
}

# Use in contract encryption
resource "hpcr_contract_encrypted" "contract" {
  contract = yamlencode({
    "workload" : "...",
    "env" : "..."
  })
  cert = data.hpcr_encryption_cert.latest.cert
}

# Output the certificate map
output "all_certs" {
  value     = data.hpcr_encryption_certs.available.certs
  sensitive = true
}
```

## Example with Dynamic Versions

```terraform
# Use with hpcr_image to get the version
data "ibm_is_images" "hyper_protect_images" {
  visibility = "public"
  status     = "available"
}

data "hpcr_image" "selected" {
  images = jsonencode(data.ibm_is_images.hyper_protect_images.images)
  spec   = ">=1.0.10"
}

# Download certificate for the selected image version
data "hpcr_encryption_certs" "selected_version" {
  versions = [data.hpcr_image.selected.version]
}

# The cert map will have one entry matching the image version
output "certificate_for_image" {
  value     = data.hpcr_encryption_certs.selected_version.certs[data.hpcr_image.selected.version]
  sensitive = true
}
```

## Example with Custom Template

```terraform
# Use a custom URL template (advanced use case)
data "hpcr_encryption_certs" "custom" {
  versions = ["1.0.10"]
  template = "https://custom.example.com/certs/hpcr-{{.Major}}.{{.Minor}}.{{.Patch}}.crt"
}
```

## Default Certificate URL

By default, certificates are downloaded from IBM's official Cloud Object Storage location:

```
https://hpvsvpcubuntu.s3.us.cloud-object-storage.appdomain.cloud/s390x-{{.Patch}}/ibm-hyper-protect-container-runtime-{{.Major}}-{{.Minor}}-s390x-{{.Patch}}-encrypt.crt
```

The template supports the following placeholders:
- `{{.Major}}` - Major version number
- `{{.Minor}}` - Minor version number
- `{{.Patch}}` - Patch version number

For version `1.0.10`, the URL expands to:
```
https://hpvsvpcubuntu.s3.us.cloud-object-storage.appdomain.cloud/s390x-10/ibm-hyper-protect-container-runtime-1-0-s390x-10-encrypt.crt
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `versions` (List of String) List of strings, each denoting the version number of the certificate to download (e.g., ['1.0.10', '1.0.11'])

### Optional

- `template` (String) Template used to download the encryption certificate. May contain placeholders: {{.Major}}, {{.Minor}}, {{.Patch}}. Default: https://hpvsvpcubuntu.s3.us.cloud-object-storage.appdomain.cloud/s390x-{{.Patch}}/ibm-hyper-protect-container-runtime-{{.Major}}-{{.Minor}}-s390x-{{.Patch}}-encrypt.crt

### Read-Only

- `certs` (Map of String) Map of certificates from version to certificate content
- `id` (String) Data source identifier
