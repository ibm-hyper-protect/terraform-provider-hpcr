---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "hpcr_image Data Source - hpcr"
subcategory: ""
description: |-
  Selects the best matching HPCR stock image from a list based on semantic versioning constraints.
---

# hpcr_image (Data Source)

Selects the best matching HPCR stock image from a JSON-formatted list based on semantic versioning constraints. This data source uses the [Masterminds/semver](https://github.com/Masterminds/semver) library to find the most appropriate image version that matches your requirements.

## How It Works

This data source:

1. **Parses Image List**: Accepts a JSON list of available VPC images (typically from the IBM Cloud `ibm_is_images` data source)
2. **Filters HPCR Images**: Identifies images that match the HPCR naming pattern
3. **Version Matching**: Uses semantic versioning to select the best match based on your `spec` constraint
4. **Returns Metadata**: Provides the image ID, name, version, and SHA256 checksum

## Semantic Version Constraints

The `spec` parameter supports standard semantic version constraints:

- `*` or omitted - Latest version (default)
- `1.0.0` - Exact version
- `>=1.0.0` - Version 1.0.0 or higher
- `~1.0.0` - Version 1.0.x (patch releases)
- `^1.0.0` - Version 1.x.x (minor and patch releases)
- `>=1.0.0 <2.0.0` - Range between versions

## Example Usage

```terraform
# Get all available public images
data "ibm_is_images" "hyper_protect_images" {
  visibility = "public"
  status     = "available"
}

# Select the latest HPCR image
data "hpcr_image" "latest" {
  images = jsonencode(data.ibm_is_images.hyper_protect_images.images)
  # spec defaults to "*" (latest)
}

# Use the selected image
output "selected_image_id" {
  value = data.hpcr_image.latest.image
}

output "selected_version" {
  value = data.hpcr_image.latest.version
}
```

## Example with Version Constraint

```terraform
# Select a specific version range
data "hpcr_image" "stable" {
  images = jsonencode(data.ibm_is_images.hyper_protect_images.images)
  spec   = "^1.0.0"  # Any 1.x.x version
}

# Select exact version
data "hpcr_image" "specific" {
  images = jsonencode(data.ibm_is_images.hyper_protect_images.images)
  spec   = "1.0.8"
}

# Select minimum version
data "hpcr_image" "minimum" {
  images = jsonencode(data.ibm_is_images.hyper_protect_images.images)
  spec   = ">=1.0.5"
}
```

## Integration with IBM Cloud Provider

```terraform
# Complete example with IBM Cloud VPC
terraform {
  required_providers {
    ibm = {
      source  = "IBM-Cloud/ibm"
      version = "~> 1.0"
    }
    hpcr = {
      source  = "ibm-hyper-protect/hpcr"
      version = "~> 1.0"
    }
  }
}

# Fetch available images from IBM Cloud
data "ibm_is_images" "hyper_protect_images" {
  visibility = "public"
  status     = "available"
}

# Select the best matching HPCR image
data "hpcr_image" "selected" {
  images = jsonencode(data.ibm_is_images.hyper_protect_images.images)
  spec   = "*"
}

# Create a virtual server instance with the selected image
resource "ibm_is_instance" "hpcr_instance" {
  name    = "my-hpcr-instance"
  image   = data.hpcr_image.selected.image
  profile = "bz2-2x8"
  # ... other configuration
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `images` (String) List of images in JSON format

### Optional

- `spec` (String) Semantic version range defining the HPCR image. Defaults to '*' (latest).

### Read-Only

- `id` (String) Data source identifier
- `image` (String) ID of the selected image
- `name` (String) Name of the selected image
- `sha256` (String) SHA256 checksum of the selected image
- `version` (String) Version number of the selected image
